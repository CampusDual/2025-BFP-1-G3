<!-- == CONTENEDOR PRINCIPAL == -->
<div class="offers-container" >

  <!-- == FILTRO DE OFERTAS == -->
  <div class="search-bar">
    <input type="text" placeholder="Buscar oferta por título/descripción" [(ngModel)]="searchTerm"
      (input)="updateDisplayOffers()"/>
    <span id="iconSearch"><mat-icon>search</mat-icon></span>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="loading-container" id="loadMeesage">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando ofertas...</p>
  </div>

  <!-- == SECCIÓN DE OFERTAS RECOMENDADAS == -->
  <div *ngIf="!isLoading && showRecommendedSection" class="recommended-section">
    <div class="recommended-header">
      <h3>
        <mat-icon>star</mat-icon>
        Recomendado para ti
      </h3>
      <p>Ofertas seleccionadas según tu perfil y especialización</p>
    </div>

    <div class="recommended-carousel" *ngIf="!loadingRecommended">
      <!-- Botón izquierdo -->
      <button mat-icon-button 
              class="carousel-nav-btn left-btn" 
              [disabled]="!canScrollLeft"
              (click)="scrollRecommendedLeft()"
              *ngIf="recommendedOffers.length > 1">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <!-- Contenedor del carrusel -->
      <div class="recommended-carousel-container" 
           (scroll)="onRecommendedScroll()">
        
        <mat-card class="recommended-offer-card" *ngFor="let offer of recommendedOffers; let i = index">
          
          <!-- Badge de recomendación -->
          <div class="recommendation-badge">
            <mat-icon>stars</mat-icon>
            <span>Top {{ i + 1 }}</span>
          </div>

          <mat-card-header>
            <div class="header-content">
              <mat-card-title>{{ offer.title }}</mat-card-title>
              <mat-card-subtitle>
                <span class="company-name">{{ offer.companyName || 'Sin nombre' }}</span>
              </mat-card-subtitle>
            </div>
          </mat-card-header>

          <mat-card-content>
            <p class="offer-description">{{ offer.offerDescription }}</p>

            <!-- Indicador de coincidencias -->
            <div class="affinity-indicator" *ngIf="offer.techLabels && offer.techLabels.length > 0">
              <mat-icon>psychology</mat-icon>
              <span>{{ offer.techLabels.length }} tecnologías coincidentes</span>
            </div>

            <!-- Etiquetas técnicas condensadas -->
            <div class="tech-labels-compact" *ngIf="offer.techLabels && offer.techLabels.length > 0">
              <span *ngFor="let label of offer.techLabels.slice(0, 3)" class="tech-chip-small">
                {{ label.name }}
              </span>
              <span *ngIf="offer.techLabels.length > 3" class="more-labels">
                +{{ offer.techLabels.length - 3 }}
              </span>
            </div>
          </mat-card-content>

          <mat-card-actions class="card-actions">
            <button mat-raised-button color="primary" 
                    (click)="viewOfferDetails(offer.id)"
                    class="view-btn">
              <mat-icon>visibility</mat-icon>
              Ver
            </button>
            
            <!-- Estado de inscripción -->
            <div *ngIf="shouldShowApplicationStatus()" class="application-status-compact">
              <button *ngIf="!isAppliedToOffer(offer.id)" 
                      mat-raised-button color="accent"
                      (click)="applyOffer(offer.id)" 
                      class="apply-btn">
                <mat-icon>send</mat-icon>
              </button>
              
              <mat-icon *ngIf="isAppliedToOffer(offer.id)" 
                        color="primary" 
                        matTooltip="Ya inscrito"
                        class="applied-icon">
                check_circle
              </mat-icon>
            </div>
          </mat-card-actions>
        </mat-card>
      </div>

      <!-- Botón derecho -->
      <button mat-icon-button 
              class="carousel-nav-btn right-btn" 
              [disabled]="!canScrollRight"
              (click)="scrollRecommendedRight()"
              *ngIf="recommendedOffers.length > 1">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <!-- Loading de ofertas recomendadas -->
    <div *ngIf="loadingRecommended" class="recommended-loading">
      <mat-spinner diameter="30"></mat-spinner>
      <p>Analizando tu perfil...</p>
    </div>
  </div>

  <!-- == TODAS LAS OFERTAS == -->
  <div class="all-offers-section" *ngIf="!isLoading">
    <div class="section-divider" *ngIf="showRecommendedSection">
      <h3>Todas las ofertas disponibles</h3>
    </div>

  <div class="cards-grid" *ngIf="filteredOffers && filteredOffers.length > 0; else noOffersOrSearch">
    <mat-card class="offer-card" *ngFor="let offer of filteredOffers">
      <mat-card-header>
        <div class="header-content">
          <mat-card-title>{{ offer.title }}</mat-card-title>
          <mat-card-subtitle>Empresa: <span class="company-name">{{ offer.companyName || 'Sin nombre'
              }}</span></mat-card-subtitle>
        </div>
      </mat-card-header>

      <mat-card-content>
        <p class="offer-description">{{ offer.offerDescription }}</p>

        <!-- Etiquetas técnicas -->
        <div class="tech-labels" *ngIf="offer.techLabels && offer.techLabels.length > 0">
          <div class="labels-container">
            <span *ngFor="let label of offer.techLabels" class="tech-chip">
              {{ label.name }}
            </span>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions class="card-actions">
        <button mat-icon-button matTooltip="Ver detalles de la oferta" class="tooltip-button"
          (click)="viewOfferDetails(offer.id)">
          <mat-icon id="info">info</mat-icon>
        </button>
        
        <!-- Mostrar estado de inscripción para candidatos -->
        <div *ngIf="shouldShowApplicationStatus()" class="application-status">
          <button *ngIf="!isAppliedToOffer(offer.id)" mat-icon-button matTooltip="Inscribirse a la oferta"
            (click)="applyOffer(offer.id)" class="tooltip-button apply-button">
            <mat-icon id="apply">outbox</mat-icon>
          </button>
          <span *ngIf="isAppliedToOffer(offer.id)" class="applied-badge-icon" matTooltip="Ya estás inscrito a esta oferta">
            <mat-icon>check_circle</mat-icon>
          </span>
        </div>
      </mat-card-actions>
    </mat-card>
  </div>
  </div>
</div>

<!-- Mensaje aviso: No hay ofertas -->
<ng-template #noOffers>
  <div id="errorMessage">
    <mat-icon>info</mat-icon>
    <p>No hay ofertas disponibles en este momento</p>
  </div>
</ng-template>

<!-- Mensaje cuando el filtro no encuentra ofertas -->
<ng-template #noOffersSearch>
  <div class="no-offers" *ngIf="!isLoading">
    <mat-icon>info</mat-icon>
    <p>No se han encontrado resultados que cumplan los criterios de búsqueda</p>
  </div>
</ng-template>

<ng-template #noOffersOrSearch>
  <ng-container *ngIf="!isLoading && offers.length === 0; else noOffersSearch">
    <ng-container *ngTemplateOutlet="noOffers"></ng-container>
  </ng-container>
</ng-template>

<!-- Controles de paginación -->
<div class="pagination-container" *ngIf="!isLoading && !isSearchActive && totalPages > 1">
  <div class="pagination-info">
    <p>Total: {{ totalOffers }} ofertas</p>
  </div>
  <div class="pagination-controls">
    <button mat-button [disabled]="currentPage === 0" (click)="previousPage()">
      <mat-icon>navigate_before</mat-icon>
      Anterior
    </button>
    <span class="page-numbers">
      <span class="current-page">{{ currentPage + 1 }}</span> / {{ totalPages }}
    </span>
    <button mat-button [disabled]="currentPage >= totalPages - 1" (click)="nextPage()">
      Siguiente
      <mat-icon>navigate_next</mat-icon>
    </button>
  </div>
</div>
